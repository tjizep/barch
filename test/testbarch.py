import time
import barch
barch.setRoute(0,"127.0.0.1",14500)
barch.clearAll()
barch.saveAll()
print(barch.repl_stats())
print(barch.ops_stats())
print(barch.stats())
print(barch.config())
r = barch.getRoute(0)
assert(r.host.s() == "127.0.0.1")
assert(r.port.i() == 14500)
barch.removeRoute(0)
r = barch.getRoute(0)
assert(r.host.s() == "" and r.port.i()==0)
barch.clear()
s = barch.size()
assert(s == 0)
k = barch.KeyValue()
assert(k.use("test"))
h = barch.HashSet()
k.set("1","one")
k.set("2","two")
k.set("3","three")
assert(k.min().i() == 1)
assert(k.max().i() == 3)
assert(k.upperBound("2").i() == 3 )
assert(k.lowerBound("2").i() == 2)
assert(k.count("2","3") == 1)
assert(k.size()==3)
assert(k.size()<=barch.sizeAll())
assert(k.get("1") == "one")
k.set('one',"1")
k.incr('one',1)
assert(k.get('one') == "2")
k.decr('one',1)
assert(k.get('one') == "1")
k.incr('one', 1.0)
assert(k.get('one') == "2")
k.decr('one',1.0)
assert(k.get('one') == "1")
k.erase('one')
assert not k.exists('one')
k.erase("1")
s = barch.sizeAll()
assert(s == 2)
barch.save()
barch.clearAll()
barch.saveAll()
assert(0 == barch.size())
h.set("k3",["f1","v1","f2","v2"])
assert(h.ttl("k3",["f1"])[0].i() == -1)
s = barch.size()
assert(h.remove("k3", ["f1"]).i() == 1)
assert(s -1 == barch.size())
assert(h.mget("k3",["f2"])[0].t() == 'string')
h.set("kxp",["f1","v1","f2","v2"])
h.expire("kxp",["10", "NX"],["f1","f2"])
assert(h.mget("kxp",["f1","f2"])[0].s() == "v1")
assert(h.ttl("kxp",["f1"])[0].i() >= 9)
s = int(time.time())
assert(h.expireat("kxp",s,"XX",["f1"])[0].i()==1)
h.set("kn",["f1","0","f2","1"])
assert(h.incrby("kn","f1",1).i() == 1)
z = barch.OrderedSet()
assert(z.add("z1",[],["1","one","2","two","3","three"]).i() == 3)
assert(z.range("z1",1.99,3.01,[])[0].s() == "two")
assert(z.range("z1",1.99,3.01,["WITHSCORES"])[1].d() == 2)
assert(z.rank("z1",0, 2).i() == 1)
assert(z.card("z1").i() == 3)

assert(z.add("z2", ["1","one","2","two","5","five"]).i() == 3)
assert(z.diff(["z1","z2"])[0].s()=="three")
assert(z.diff(["z2","z1"])[0].s()=="five")
assert(z.inter(["z2","z1"])[0].s()=="one")
assert(z.intercard(["z2","z1"]).i()==2)
assert(z.diffstore("z1.2",["z1","z2"]).i()==1)
assert(z.diffstore("z2.1",["z2","z1"]).i()==1)
assert(z.card("z2.1").i() == 1)

assert(z.popmin("z1").i() == 1)
assert(z.card("z1").i() == 2)
assert(z.range("z1",1.99,3.01,["WITHSCORES"])[1].d() == 2)
assert(z.popmax("z1").i() == 3)
assert(z.range("z1",1.99,3.01,["WITHSCORES"])[1].d() == 2)
s = barch.size()
assert(z.remove("z1","1").i() == 1)
assert(barch.size() + 1 == s)

assert(z.add("zi", ["1","one","2","two","5","five"]).i() == 3)
s = barch.size()
z.incrby("zi",11,"one")
assert(z.range("zi", 0,10)[0].s()=="two")
assert(z.card("zi").i()==3)
assert(z.range("zi", 10.5, 20)[0].s()=="one")

assert (s==barch.size())
barch.save()
assert(z.remrangebylex("zi", "ona", "ond").s()=="0")
assert(z.remrangebylex("zi", "ona", "onf").s()=="1")
assert(z.remrangebylex("zi", "tw", "two").s()=="1")
assert (s==barch.size()+4)

for i in range(10000):
    k.set(f"z{str(i)}",str(i))
# the range end is not inclusive
r = k.range(f"z1000",f"z1009",11)
assert(len(r)==9)
assert(r[0].s()=="z1000")
assert(r[1].s()=="z1001")